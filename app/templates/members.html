{% extends "base.html" %}
{% block content %}
{% set renting_members = renting_members or [] %}
{% set active_members = active_members or [] %}
{% set inactive_members = inactive_members or [] %}
<div class="flex items-center justify-between mb-4">
  <h2 class="text-2xl md:text-3xl font-semibold">{{ t('Leden') }}</h2>
  <a href="{{ url_for('main.members_new') }}" class="btn btn-primary">{{ t('Nieuw lid') }}</a>
  
</div>

<!-- Leden met actieve verhuring -->
<!-- Verhuringen tabel verwijderd, focus op Actief/Inactief -->

<!-- Actieve leden -->
<div class="members-table-wrapper card table-card p-4 mb-6">
  <h3 class="text-lg font-semibold mb-3">{{ t('Actieve leden') }} ({{ active_members|length }})</h3>
  <table class="w-full text-left table-fixed">
    <thead class="bg-gray-50 text-sm">
      <tr>
        <th class="py-2 px-3" style="width:22%">{{ t('Naam') }}</th>
        <th class="py-2 px-3" style="width:22%">{{ t('E-mail') }}</th>
        <th class="py-2 px-3" style="width:12%">{{ t('Telefoon') }}</th>
        <th class="py-2 px-3" style="width:22%">{{ t('Adres') }}</th>
        <th class="py-2 px-3" style="width:10%">{{ t('Laatste betaling') }}</th>
        <th class="py-2 px-3" style="width:7%">{{ t('Kinderen') }}</th>
        <th class="py-2 px-3 text-right" style="width:5%">{{ t('Acties') }}</th>
      </tr>
    </thead>
    <tbody class="text-sm">
      {% for m in active_members %}
      <tr class="border-t">
        <td class="py-2 px-3 whitespace-nowrap font-medium">{{ m.first_name }} {{ m.last_name }}</td>
        <td class="py-2 px-3 truncate" title="{{ m.email or '-' }}">{{ m.email or '-' }}</td>
        <td class="py-2 px-3">{{ m.phone or '-' }}</td>
        <td class="py-2 px-3 truncate" title="{{ m.address or '' }}">{% if m.address %}{{ m.address }}{% else %}<span class="text-gray-600">{{ t('Geen adres') }}</span>{% endif %}</td>
        {% set payment_status = 'none' if not m.last_payment else ('overdue' if (today - m.last_payment).days > 365 else 'ok') %}
        <td class="py-2 px-3">{% if payment_status == 'none' %}<span class="text-red-600">{{ t('Geen betaling') }}</span>{% elif payment_status == 'overdue' %}{{ t('Overdue') }}{% else %}{{ m.last_payment and m.last_payment.strftime('%Y-%m-%d') or '-' }}{% endif %}</td>
        <td class="py-2 px-3 text-center"><a href="{{ url_for('main.members_children', member_id=m.member_id) }}" class="link">{{ t('Zie kinderen') }}</a></td>
        <td class="py-2 px-3 text-right">
          <form method="POST" action="{{ url_for('main.members_delete', member_id=m.member_id) }}" class="inline-block" onsubmit="return confirmDeleteMember(event, '{{ m.first_name }} {{ m.last_name }}', {{ m.children|length if m.children else 0 }});">
            <button class="icon-btn" aria-label="{{ t('Verwijderen') }}" title="{{ t('Verwijderen') }}">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M8 6V4h8v2"/><path d="M10 11v6"/><path d="M14 11v6"/><path d="M5 6l1 14a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2l1-14"/></svg>
            </button>
          </form>
        </td>
      </tr>
      {% else %}
      <tr><td class="py-6 px-4 text-gray-600" colspan="7">{{ t('Geen leden in deze categorie.') }}</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Inactieve leden -->
<div class="members-table-wrapper card table-card p-4 mb-6">
  <h3 class="text-lg font-semibold mb-3">{{ t('Inactieve leden') }} ({{ inactive_members|length }})</h3>
  <table class="w-full text-left table-fixed">
    <thead class="bg-gray-50 text-sm">
      <tr>
        <th class="py-2 px-3" style="width:22%">{{ t('Naam') }}</th>
        <th class="py-2 px-3" style="width:22%">{{ t('E-mail') }}</th>
        <th class="py-2 px-3" style="width:12%">{{ t('Telefoon') }}</th>
        <th class="py-2 px-3" style="width:22%">{{ t('Adres') }}</th>
        <th class="py-2 px-3" style="width:10%">{{ t('Laatste betaling') }}</th>
        <th class="py-2 px-3" style="width:7%">{{ t('Kinderen') }}</th>
        <th class="py-2 px-3 text-right" style="width:5%">{{ t('Acties') }}</th>
      </tr>
    </thead>
    <tbody class="text-sm">
      {% for m in inactive_members %}
      <tr class="border-t">
        <td class="py-2 px-3 whitespace-nowrap font-medium">{{ m.first_name }} {{ m.last_name }}</td>
        <td class="py-2 px-3 truncate" title="{{ m.email or '-' }}">{{ m.email or '-' }}</td>
        <td class="py-2 px-3">{{ m.phone or '-' }}</td>
        <td class="py-2 px-3 truncate" title="{{ m.address or '' }}">{% if m.address %}{{ m.address }}{% else %}<span class="text-gray-600">{{ t('Geen adres') }}</span>{% endif %}</td>
        {% set payment_status = 'none' if not m.last_payment else ('overdue' if (today - m.last_payment).days > 365 else 'ok') %}
        <td class="py-2 px-3">{% if payment_status == 'none' %}<span class="text-red-600">{{ t('Geen betaling') }}</span>{% elif payment_status == 'overdue' %}{{ t('Overdue') }}{% else %}{{ m.last_payment and m.last_payment.strftime('%Y-%m-%d') or '-' }}{% endif %}</td>
        <td class="py-2 px-3 text-center"><a href="{{ url_for('main.members_children', member_id=m.member_id) }}" class="link">{{ t('Zie kinderen') }}</a></td>
        <td class="py-2 px-3 text-right">
          <form method="POST" action="{{ url_for('main.members_delete', member_id=m.member_id) }}" class="inline-block" onsubmit="return confirmDeleteMember(event, '{{ m.first_name }} {{ m.last_name }}', {{ m.children|length if m.children else 0 }});">
            <button class="icon-btn" aria-label="{{ t('Verwijderen') }}" title="{{ t('Verwijderen') }}">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M8 6V4h8v2"/><path d="M10 11v6"/><path d="M14 11v6"/><path d="M5 6l1 14a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2l1-14"/></svg>
            </button>
          </form>
        </td>
      </tr>
      {% else %}
      <tr><td class="py-6 px-4 text-gray-600" colspan="7">{{ t('Geen leden in deze categorie.') }}</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script>
function confirmDeleteMember(event, memberName, childrenCount) {
  event.preventDefault();
  let message = '{{ t("Weet je zeker dat je dit lid wilt verwijderen?") }}\n\n' + memberName;
  if (childrenCount > 0) {
    message += '\n\n⚠️ {{ t("Let op: Dit lid heeft") }} ' + childrenCount + ' {{ t("kind(eren) geregistreerd.") }}';
    message += '\n{{ t("Deze worden ook verwijderd!") }}';
  }
  message += '\n\n{{ t("Deze actie kan niet ongedaan gemaakt worden.") }}';
  if (confirm(message)) {
    event.target.submit();
  }
  return false;
}
</script>
<!-- Overzicht fallback verwijderd op verzoek -->
{% endblock %}
