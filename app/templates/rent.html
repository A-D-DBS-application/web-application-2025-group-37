{% extends "base.html" %}
{% block content %}
<h2 class="section-title text-2xl md:text-3xl font-semibold mb-4">Fiets verhuren</h2>
<div class="card p-6 max-w-xl mx-auto">
  <div class="mb-4">
    <h3 class="text-xl font-bold">{{ bike.name }}</h3>
    <p class="text-gray-600">Type: {{ bike.type or '-' }}</p>
  </div>
  <form method="POST" class="space-y-4">
    <div>
      <label class="block mb-1 font-medium">Lid</label>
      <select name="member_id" id="member-select" class="border w-full rounded p-2 focus:outline-none focus:ring-2 focus:ring-green-200" required>
        <option value="">Kies lid...</option>
        {% for m in members %}
          <option value="{{ m.member_id }}" data-children='[{% for c in m.children %}{"id":"{{ c.child_id }}","name":"{{ c.first_name }} {{ c.last_name }}"}{% if not loop.last %},{% endif %}{% endfor %}]'>
            {{ m.last_name }}, {{ m.first_name }}
          </option>
        {% endfor %}
      </select>
    </div>
    <div>
      <label class="block mb-1 font-medium">Kind (optioneel)</label>
      <select name="child_id" id="child-select" class="border w-full rounded p-2 focus:outline-none focus:ring-2 focus:ring-green-200">
        <option value="">Geen kind</option>
      </select>
    </div>
    <div>
      <label class="block mb-1 font-medium">Startdatum</label>
      <input type="date" name="start_date" class="border w-full rounded p-2 focus:outline-none focus:ring-2 focus:ring-green-200" />
    </div>
    <div class="flex items-center gap-3">
      <button class="btn btn-primary">Verhuren</button>
      <a class="btn" href="{{ url_for('main.bike_list') }}">Annuleren</a>
    </div>
  </form>
</div>

<script>
  const memberSelect = document.getElementById('member-select');
  const childSelect = document.getElementById('child-select');
  memberSelect.addEventListener('change', function() {
    const opt = this.options[this.selectedIndex];
    const data = opt.getAttribute('data-children');
    let children = [];
    try { children = JSON.parse(data || '[]'); } catch(e) { children = []; }
    childSelect.innerHTML = '<option value="">Geen kind</option>';
    for (const c of children) {
      const o = document.createElement('option');
      o.value = c.id; o.textContent = c.name;
      childSelect.appendChild(o);
    }
  });
</script>
{% endblock %}
